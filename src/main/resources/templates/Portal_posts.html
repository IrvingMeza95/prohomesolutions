<!DOCTYPE html>
<html
  lang="en"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
  <head th:replace="fragments/Head :: head"></head>
  <body>
    <nav th:replace="fragments/Navbar :: nav_bar"></nav>

    <div th:replace="fragments/Options_toggle :: options_toggle"></div>

    <div th:replace="fragments/Modals :: modals"></div>

    <main class="">
      <div class="row row-cols-1 row-cols-md-3 g-4">
        <div th:each="post : ${posts}">
          <div class="col">
            <div class="card">
              <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center p-2 gap-2">
                  <img
                    th:if="${post.provider.profilePicture != null}"
                    th:src="@{/file/image/__${post.provider.profilePicture.id}__}"
                    class="rounded-5"
                    style="width: 40px; height: 40px"
                  />
                  <img
                    th:if="${post.provider.profilePicture == null}"
                    src="/img/PP vacia.png"
                    class="rounded-5"
                    style="width: 40px; height: 40px"
                  />
                  <a
                    th:href="@{/provider/profile/__${post.provider.id}__}"
                    th:text="${post.provider.name}"
                  ></a>
                </div>
                <div th:if="${session.userSession.role.name == 'ADMIN'}">
                  <a
                    th:href="@{/post/change-visiblity/__${post.id}__}"
                    th:if="${post.visible == true}"
                    class="p-2"
                    ><img
                      style="width: 25px; height: 25px"
                      src="/img/Desbloquedo.png"
                  /></a>
                  <a
                    th:href="@{/post/change-visiblity/__${post.id}__}"
                    th:if="${post.visible == false}"
                    class="p-2"
                    ><img
                      style="width: 25px; height: 25px"
                      src="/img/Bloqueado.png"
                  /></a>
                </div>
              </div>
              <a th:href="@{/post/post-view/__${post.id}__}" class="btn">
                <img
                  th:src="@{/file/image/__${post.image.id}__}"
                  class="card-img-top"
                  alt="..."
                />
              </a>
              <div class="card-body text-bg-light p-3">
                <h5
                  th:text="'Work of ' + ${post.provider.providerType.tag} + ' for a price of $' + ${post.provider.price} + ' ' + ${post.provider.feeTypes.tag} + '.'"
                  class="card-title"
                ></h5>
                <p th:text="${post.description}" class="card-text"></p>
                <p class="card-text text-end">
                  <small
                    th:text="'Published on ' + ${post.postDate}"
                    class="text-body-secondary"
                  ></small>
                </p>
              </div>
              <div class="d-flex justify-content-around">
                <a
                  type="bundle"
                  data-bs-toggle="modal"
                  th:data-bs-target="@{#commentBox-__${post.id}__}"
                  class="btn d-flex justify-content-center align-items-center gap-2"
                >
                  <span th:text="${post.comments.size}"></span>
                  <img
                    src="/img/Comentarios.png"
                    style="width: 25px; height: 25px"
                  />
                </a>
                <div
                  class="d-flex justify-content-center align-items-center gap-2"
                >
                  <span th:text="${post.likes.size}"></span>
                  <a
                    th:if="${session.userSession.userType.name == 'CUSTOMER'}"
                    th:href="@{/customer/like-post/__${post.id}__}"
                  >
                    <img
                      src="/img/Corazon vacio.png"
                      style="width: 25px; height: 25px"
                    />
                  </a>
                  <img
                    th:if="${session.userSession.userType.name == 'PROVIDER'}"
                    src="/img/Corazon vacio.png"
                    style="width: 25px; height: 25px"
                  />
                </div>
              </div>

              <!-- Comment box -->
              <div
                class="modal fade"
                th:id="@{commentBox-__${post.id}__}"
                tabindex="-1"
                aria-labelledby="exampleModalLabel"
                aria-hidden="true"
              >
                <div class="modal-dialog modal-dialog-scrollable">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h1 class="modal-title fs-5" id="exampleModalLabel">
                        Comments box
                      </h1>
                      <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                      ></button>
                    </div>
                    <div class="modal-body">
                      <div
                        th:replace="fragments/Post_comment_box :: post_comment_box"
                      ></div>
                    </div>
                    <div
                      th:if="${session.userSession.userType.name == 'CUSTOMER'}"
                      class="modal-footer"
                    >
                      <a
                        th:href="@{/post/post-view/__${post.id}__}"
                        class="btn btn-primary"
                      >
                        Add comment
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
